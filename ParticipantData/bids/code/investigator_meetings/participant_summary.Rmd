---
title: "sample summary"
author: "baf44"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(devtools)
load_all("/Users/bari/projects/dataREACHr")

# set base_dir
base_dir = "/Users/bari/Library/CloudStorage/OneDrive-ThePennsylvaniaStateUniversity/b-childfoodlab_Shared/Active_Studies/MarketingResilienceRO1_8242020/ParticipantData/"

# define names of redcap files to process
visit_file_name =  "FoodMarketingResilie_DATA_2024-07-29_1212.csv"
double_entry_file_name = "REACHDataDoubleEntry_DATA_2024-04-08_1306.csv"

#### process redcap data ####

# assign paths to data downloaded from redcap
visit_data_path = paste0(base_dir, "/bids/sourcedata/phenotype/", visit_file_name)
data_de_path = paste0(base_dir, "/bids/sourcedata/phenotype/", double_entry_file_name)

# process redcap data and export into bids/phenotype
redcap_data <-
  proc_redcap(visit_data_path,
              data_de_path,
              overwrite = FALSE,
              return_data = TRUE)

#extract participants data
participants_data <- redcap_data$phenotype_data$participants

```

To do: figure out which children have BMI's outside of range


```{r visit counts by risk counts}

# make long dataframe of visit dates
visits_long <- participants_data %>%
  pivot_longer(cols = child_protocol_1_date:child_protocol_5_date, names_to = "child_protocol_number", values_to = "child_protocol_date") %>%
  filter(!is.na(child_protocol_date))


# Plot: visit protocol counts by risk status
ggplot(visits_long, aes(x = child_protocol_number, fill = risk_status_maternal.y)) +
  geom_bar(position = "dodge", stat = "count") +
  geom_text(data = counts, aes(x = Column, y = Count, label = Count, group = risk_status_maternal.y),
            position = position_dodge(width = 0.9), vjust = -0.5) +
  labs(title = "Number of Visits per Visit Protocol by Risk", x = "Visit protocol", y = "Count") +
  theme_minimal()


```
